# ===----------------------------------------------------------------------=== #
#
# This file is Modular Inc proprietary.
#
# ===----------------------------------------------------------------------=== #
# RUN: %mojo -debug-level full %s | FileCheck %s

from gpu import ThreadIdx
from gpu.host._compile import _compile_nvptx


fn kernel(x: Int) -> Int:
    return ThreadIdx.x()


fn parametric[f: fn (Int) -> Int]() -> Int:
    return f(42)


fn main():
    # CHECK: Generated by LLVM NVPTX Back-End
    # CHECK: .visible .entry _test_compile_nvptx_kernel
    print(_compile_nvptx[fn (Int) -> Int, kernel]().asm)
    # CHECK: Generated by LLVM NVPTX Back-End
    # CHECK: .visible .entry _test_compile_nvptx_parametric_fn_
    print(_compile_nvptx[fn () -> Int, parametric[kernel]]().asm)
    # CHECK: ; ModuleID =
    # CHECK: lvm.nvvm.read.ptx.sreg.tid.x()
    print(
        _compile_nvptx[
            fn () -> Int, parametric[kernel], emission_kind="llvm"
        ]().asm
    )
